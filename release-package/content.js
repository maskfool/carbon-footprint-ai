var i=Object.defineProperty;var o=(s,t,e)=>t in s?i(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>o(s,typeof t!="symbol"?t+"":t,e);class h{constructor(){a(this,"observer",null);a(this,"tabId",null);a(this,"stats",{domain:"",totalBytes:0,lastUpdated:Date.now(),entryCount:0,entries:[]});this.init()}init(){this.getCurrentTabId().then(t=>{this.tabId=t,this.stats.domain=this.getDomainFromUrl(window.location.href),this.startMonitoring()}),setInterval(()=>{this.reportStats()},2e3)}async getCurrentTabId(){return new Promise(t=>{chrome.runtime.sendMessage({action:"getTabId"},e=>{t((e==null?void 0:e.tabId)||0)})})}getDomainFromUrl(t){try{return new URL(t).hostname}catch{return"unknown"}}startMonitoring(){if(!("PerformanceObserver"in window)){console.warn("PerformanceObserver not supported");return}try{this.observer=new PerformanceObserver(t=>{t.getEntries().forEach(r=>{var n;r.transferSize&&r.transferSize>0&&(this.stats.totalBytes+=r.transferSize,this.stats.entryCount++,(n=this.stats.entries)==null||n.push({transferSize:r.transferSize,name:r.name,startTime:r.startTime}))}),this.stats.lastUpdated=Date.now()}),this.observer.observe({entryTypes:["resource"]})}catch(t){console.warn("Failed to start performance monitoring:",t)}}reportStats(){var t;this.tabId&&this.stats.totalBytes>0&&chrome.runtime.sendMessage({action:"updateStats",tabId:this.tabId,stats:{domain:this.stats.domain,totalBytes:this.stats.totalBytes,lastUpdated:this.stats.lastUpdated,entryCount:((t=this.stats.entries)==null?void 0:t.length)||0}})}getStats(){return{...this.stats}}reset(){this.stats={domain:this.getDomainFromUrl(window.location.href),totalBytes:0,lastUpdated:Date.now(),entryCount:0,entries:[]}}}const d=new h;window.carbonMonitor=d;
